function I(r){var t=new a(r),s=t.readChunk();if(s.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var f=h(s.data),o=[],d=0;!t.eof()&&d<f.numTracks;d++){var e=t.readChunk();if(e.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+e.id+"'";var i=U(e.data);o.push(i)}return{header:f,tracks:o}}function h(r){var t=new a(r),s=t.readUInt16(),f=t.readUInt16(),o={format:s,numTracks:f},d=t.readUInt16();return d&32768?(o.framesPerSecond=256-(d>>8),o.ticksPerFrame=d&255):o.ticksPerBeat=d,o}function U(r){for(var t=new a(r),s=[];!t.eof();){var f=d();s.push(f)}return s;var o;function d(){var e={};e.deltaTime=t.readVarInt();var i=t.readUInt8();if((i&240)===240)if(i===255){e.meta=!0;var p=t.readUInt8(),n=t.readVarInt();switch(p){case 0:if(e.type="sequenceNumber",n!==2)throw"Expected length for sequenceNumber event is 2, got "+n;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(n),e;case 2:return e.type="copyrightNotice",e.text=t.readString(n),e;case 3:return e.type="trackName",e.text=t.readString(n),e;case 4:return e.type="instrumentName",e.text=t.readString(n),e;case 5:return e.type="lyrics",e.text=t.readString(n),e;case 6:return e.type="marker",e.text=t.readString(n),e;case 7:return e.type="cuePoint",e.text=t.readString(n),e;case 32:if(e.type="channelPrefix",n!=1)throw"Expected length for channelPrefix event is 1, got "+n;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",n!=1)throw"Expected length for portPrefix event is 1, got "+n;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",n!=0)throw"Expected length for endOfTrack event is 0, got "+n;return e;case 81:if(e.type="setTempo",n!=3)throw"Expected length for setTempo event is 3, got "+n;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",n!=5)throw"Expected length for smpteOffset event is 5, got "+n;var x=t.readUInt8(),v={0:24,32:25,64:29,96:30};return e.frameRate=v[x&96],e.hour=x&31,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",n!=2&&n!=4)throw"Expected length for timeSignature event is 4 or 2, got "+n;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),n===4?(e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",n!=2)throw"Expected length for keySignature event is 2, got "+n;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(n),e;default:return e.type="unknownMeta",e.data=t.readBytes(n),e.metatypeByte=p,e}}else if(i==240){e.type="sysEx";var n=t.readVarInt();return e.data=t.readBytes(n),e}else if(i==247){e.type="endSysEx";var n=t.readVarInt();return e.data=t.readBytes(n),e}else throw"Unrecognised MIDI event type byte: "+i;else{var u;if(i&128)u=t.readUInt8(),o=i;else{if(o===null)throw"Running status byte encountered before status byte";u=i,i=o,e.running=!0}var y=i>>4;switch(e.channel=i&15,y){case 8:return e.type="noteOff",e.noteNumber=u,e.velocity=t.readUInt8(),e;case 9:var c=t.readUInt8();return e.type=c===0?"noteOff":"noteOn",e.noteNumber=u,e.velocity=c,c===0&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=u,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=u,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=u,e;case 13:return e.type="channelAftertouch",e.amount=u,e;case 14:return e.type="pitchBend",e.value=u+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+y}}}}function a(r){this.buffer=r,this.bufferLen=this.buffer.length,this.pos=0}a.prototype.eof=function(){return this.pos>=this.bufferLen};a.prototype.readUInt8=function(){var r=this.buffer[this.pos];return this.pos+=1,r};a.prototype.readInt8=function(){var r=this.readUInt8();return r&128?r-256:r};a.prototype.readUInt16=function(){var r=this.readUInt8(),t=this.readUInt8();return(r<<8)+t};a.prototype.readInt16=function(){var r=this.readUInt16();return r&32768?r-65536:r};a.prototype.readUInt24=function(){var r=this.readUInt8(),t=this.readUInt8(),s=this.readUInt8();return(r<<16)+(t<<8)+s};a.prototype.readInt24=function(){var r=this.readUInt24();return r&8388608?r-16777216:r};a.prototype.readUInt32=function(){var r=this.readUInt8(),t=this.readUInt8(),s=this.readUInt8(),f=this.readUInt8();return(r<<24)+(t<<16)+(s<<8)+f};a.prototype.readBytes=function(r){var t=this.buffer.slice(this.pos,this.pos+r);return this.pos+=r,t};a.prototype.readString=function(r){var t=this.readBytes(r);return String.fromCharCode.apply(null,t)};a.prototype.readVarInt=function(){for(var r=0;!this.eof();){var t=this.readUInt8();if(t&128)r+=t&127,r<<=7;else return r+t}return r};a.prototype.readChunk=function(){var r=this.readString(4),t=this.readUInt32(),s=this.readBytes(t);return{id:r,length:t,data:s}};var m=I,b=m;export{b as p};
