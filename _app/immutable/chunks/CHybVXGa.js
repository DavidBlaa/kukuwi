import"./Bg9kRutz.js";import{p as se,t as $,g as i,r as g,a as ie,b as p,u as ee,f as te,c as w,s as A,d as v,e as we}from"./DtheE3jy.js";import{a as T,t as R,c as ke}from"./wjpkEnKZ.js";import{i as re}from"./DL0CXfjA.js";import{e as oe,i as ue}from"./IuEKj3BP.js";import{b as Ue,p as k}from"./DeB9t10T.js";import{o as Be}from"./CX6xJHsj.js";import{b as ae}from"./0xqX5zhW.js";import{d as Pe}from"./Cf7Zpnqz.js";import{a as ne,B as Se}from"./dz11zXrF.js";import{a as De,b as Te,G as Ee}from"./CKh1z_6z.js";import{M as Me}from"./BN9go86y.js";import{R as Ce}from"./XLBEC18g.js";function Re(r){var t=new l(r),d=t.readChunk();if(d.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+d.id+"'";for(var m=Fe(d.data),u=[],o=0;!t.eof()&&o<m.numTracks;o++){var e=t.readChunk();if(e.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+e.id+"'";var c=Ne(e.data);u.push(c)}return{header:m,tracks:u}}function Fe(r){var t=new l(r),d=t.readUInt16(),m=t.readUInt16(),u={format:d,numTracks:m},o=t.readUInt16();return o&32768?(u.framesPerSecond=256-(o>>8),u.ticksPerFrame=o&255):u.ticksPerBeat=o,u}function Ne(r){for(var t=new l(r),d=[];!t.eof();){var m=o();d.push(m)}return d;var u;function o(){var e={};e.deltaTime=t.readVarInt();var c=t.readUInt8();if((c&240)===240)if(c===255){e.meta=!0;var U=t.readUInt8(),a=t.readVarInt();switch(U){case 0:if(e.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(a),e;case 2:return e.type="copyrightNotice",e.text=t.readString(a),e;case 3:return e.type="trackName",e.text=t.readString(a),e;case 4:return e.type="instrumentName",e.text=t.readString(a),e;case 5:return e.type="lyrics",e.text=t.readString(a),e;case 6:return e.type="marker",e.text=t.readString(a),e;case 7:return e.type="cuePoint",e.text=t.readString(a),e;case 32:if(e.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return e;case 81:if(e.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var B=t.readUInt8(),E={0:24,32:25,64:29,96:30};return e.frameRate=E[B&96],e.hour=B&31,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),a===4?(e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(a),e;default:return e.type="unknownMeta",e.data=t.readBytes(a),e.metatypeByte=U,e}}else if(c==240){e.type="sysEx";var a=t.readVarInt();return e.data=t.readBytes(a),e}else if(c==247){e.type="endSysEx";var a=t.readVarInt();return e.data=t.readBytes(a),e}else throw"Unrecognised MIDI event type byte: "+c;else{var _;if(c&128)_=t.readUInt8(),u=c;else{if(u===null)throw"Running status byte encountered before status byte";_=c,c=u,e.running=!0}var N=c>>4;switch(e.channel=c&15,N){case 8:return e.type="noteOff",e.noteNumber=_,e.velocity=t.readUInt8(),e;case 9:var I=t.readUInt8();return e.type=I===0?"noteOff":"noteOn",e.noteNumber=_,e.velocity=I,I===0&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=_,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=_,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=_,e;case 13:return e.type="channelAftertouch",e.amount=_,e;case 14:return e.type="pitchBend",e.value=_+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+N}}}}function l(r){this.buffer=r,this.bufferLen=this.buffer.length,this.pos=0}l.prototype.eof=function(){return this.pos>=this.bufferLen};l.prototype.readUInt8=function(){var r=this.buffer[this.pos];return this.pos+=1,r};l.prototype.readInt8=function(){var r=this.readUInt8();return r&128?r-256:r};l.prototype.readUInt16=function(){var r=this.readUInt8(),t=this.readUInt8();return(r<<8)+t};l.prototype.readInt16=function(){var r=this.readUInt16();return r&32768?r-65536:r};l.prototype.readUInt24=function(){var r=this.readUInt8(),t=this.readUInt8(),d=this.readUInt8();return(r<<16)+(t<<8)+d};l.prototype.readInt24=function(){var r=this.readUInt24();return r&8388608?r-16777216:r};l.prototype.readUInt32=function(){var r=this.readUInt8(),t=this.readUInt8(),d=this.readUInt8(),m=this.readUInt8();return(r<<24)+(t<<16)+(d<<8)+m};l.prototype.readBytes=function(r){var t=this.buffer.slice(this.pos,this.pos+r);return this.pos+=r,t};l.prototype.readString=function(r){var t=this.readBytes(r);return String.fromCharCode.apply(null,t)};l.prototype.readVarInt=function(){for(var r=0;!this.eof();){var t=this.readUInt8();if(t&128)r+=t&127,r<<=7;else return r+t}return r};l.prototype.readChunk=function(){var r=this.readString(4),t=this.readUInt32(),d=this.readBytes(t);return{id:r,length:t,data:d}};var He=Re,Oe=He,Ge=R("<div></div>"),Ae=R("<button></button>");function je(r,t){se(t,!0);let d=Ue(t,"active",11,!1);const m=k([]);for(const[o,e]of t.pattern_array.entries())e?o%16<=3||8<=o%16&&o%16<=11?m.push("bg-green-600"):m.push("bg-green-700"):o%16<=3||8<=o%16&&o%16<=11?m.push("bg-gray-300"):m.push("bg-gray-400");var u=Ae();u.__mouseup=function(...o){var e;(e=t.onmouseup)==null||e.apply(this,o)},oe(u,21,()=>m,ue,(o,e)=>{var c=Ge();$(()=>ne(c,`h-full ${i(e)??""} border border-black`)),T(o,c)}),g(u),$(()=>ne(u,` grid h-full w-full grid-cols-16 flex-row border-4 ${(d()?"border-blue-600 shadow-2xl shadow-blue-600 ":"border-gray-500")??""} rounded`)),T(r,u),ie()}Pe(["mouseup"]);const Ve=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"Drum"},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"Drum"},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"Drum"},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"Drum"},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"Drum"},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"Drum"},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"Drum"},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"Drum"},{midi_src:"3_AmenBreaks.mid",audio_src:"3_Amen Breaks.wav",instrument_type:"Drum"},{midi_src:"3_Custom1.mid",audio_src:"3_Custom 1.wav",instrument_type:"Drum"},{midi_src:"3_Rock1.mid",audio_src:"3_Rock 1.wav",instrument_type:"Drum"},{midi_src:"3_Rumba.mid",audio_src:"3_Rumba.wav",instrument_type:"Drum"},{midi_src:"3_SiberianNights.mid",audio_src:"3_Siberian Nights.wav",instrument_type:"Drum"},{midi_src:"3_SonClave.mid",audio_src:"3_Son Clave.wav",instrument_type:"Drum"},{midi_src:"4_FunkyDrummer.mid",audio_src:"4_Funky Drummer.wav",instrument_type:"Drum"},{midi_src:"4_House1.mid",audio_src:"4_House 1.wav",instrument_type:"Drum"},{midi_src:"4_House2.mid",audio_src:"4_House 2.wav",instrument_type:"Drum"},{midi_src:"4_Rock2.mid",audio_src:"4_Rock 2.wav",instrument_type:"Drum"},{midi_src:"bass_1.mid",audio_src:"bass_1.wav",instrument_type:"Bass"},{midi_src:"bass_2.mid",audio_src:"bass_2.wav",instrument_type:"Bass"},{midi_src:"bass_3.mid",audio_src:"bass_3.wav",instrument_type:"Bass"},{midi_src:"piano_1.mid",audio_src:"piano_1.wav",instrument_type:"Piano"},{midi_src:"piano_2.mid",audio_src:"piano_2.wav",instrument_type:"Piano"},{midi_src:"piano_3.mid",audio_src:"piano_3.wav",instrument_type:"Piano"},{midi_src:"piano_4.mid",audio_src:"piano_4.wav",instrument_type:"Piano"}];var qe=R('<div class="h-full w-full basis-1/6"><!></div>'),Le=R('<p class="px-6 py-3">Raten</p>'),ze=R('<div class="absolute left-0 top-0"><!></div>'),We=R('<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="bg-s h-11/12 border-12 ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <!></div></div> <!></div> <div class="absolute left-3 top-0 m-2 mt-4"><!></div>',1);function it(r,t){se(t,!0);const d=k([]);let m=v(0),u=v(-1),o=v(!1),e=v("4_Rock 2.wav"),c=v(!1),U=v(!0),a=v(!1),B=v(!1),E=v(0),_=v(!0),N=0,I=v(0),J=0;const de=async(n,f)=>{const x=await(await fetch(ae+"/midis/"+n)).arrayBuffer(),M=new Uint8Array(x),Y=Oe(M),h={};let C=[],F=0,Z=0;for(const s of Y.tracks[0])F+=s.deltaTime,s.type==="noteOn"?(s.noteNumber in h||(h[s.noteNumber]=[],Z++),h[s.noteNumber].push(F)):s.type==="noteOff"&&h[s.noteNumber].push(F);let P=[],H=1e4,z=0;for(const[,s]of Object.entries(h)){let D=[];for(let b=0;b<s.length;b+=2){let G=s[b+1]-s[b];H=Math.min(H,G),z=Math.max(z,s[b+1]),D.push({start:s[b],len:G})}P.push(D)}let S=z/16;const O=[6,12,24,48,96];if(!O.includes(S)){for(let s=0;s<O.length;s++)if(S<=O[s]){S=O[s];break}}H%S!==0&&(S=H),P=P.reverse(),C=new Array(16*Z).fill(!1);for(let s=0;s<P.length;s++)for(let D=0;D<P[s].length;D++){let b=s*16+P[s][D].start/S,G=b+P[s][D].len/S;for(let W=b;W<G;W++)C[W]=!0}J=Math.max(J,C.length),d.push({pattern:C,selected:!1,index:f})};Be(()=>{let n;switch(t.difficulty){case 1:{n="Piano";break}case 2:{n="Bass";break}default:n="Drum"}const f=De(Ve.filter(y=>y.instrument_type===n),3);p(m,k(Te(f))),p(e,k(f[i(m)].audio_src));for(const[y,x]of f.entries())de(x.midi_src,y);p(o,!0),pe(),p(U,!1),ee(I)});function ce(n){i(u)!=n&&(p(u,k(n)),d.forEach(f=>{f.selected=f.index===n}))}function me(){p(B,i(m)===i(u)),p(_,!1),p(U,!0),p(c,!0),p(a,!1)}function fe(){const n=le();t.handleNextRound(n),p(c,!1)}function le(){let n=0;return i(B)&&(n+=1e4,n+=Math.max(-236*i(E)+8e3,2e3*.9^i(E)),n+=Math.max(-1234*i(I)+5e3,2e3*.9^i(I))),n}function pe(){setInterval(()=>{i(_)&&ee(E)},1e3)}var K=We(),j=te(K),V=w(j),q=w(V),_e=w(q);{var ve=n=>{var f=ke(),y=te(f);oe(y,17,()=>d,ue,(x,M,Y)=>{var h=qe(),C=w(h);je(C,{get pattern_array(){return i(M).pattern},onmouseup:()=>ce(i(M).index),get active(){return i(M).selected},set active(F){i(M).selected=F}}),g(h),T(x,h)}),T(n,f)};re(_e,n=>{i(o)&&n(ve)})}g(q);var Q=A(q,2),L=w(Q),ye=w(L),xe=we(()=>ae+"/audios/pattern_sounds/"+i(e));Me(ye,{get repeats(){return i(I)},get time(){return i(E)},get trackSource(){return i(xe)},get tries(){return N},get volume(){return t.volume},get trackPaused(){return i(U)},set trackPaused(n){p(U,k(n))}}),g(L);var he=A(L,2);Se(he,{bgBack:"bg-amber-700",bgFront:"bg-amber-500",onmousedown:()=>me(),style:"mt-3 text-3xl",children:(n,f)=>{var y=Le();T(n,y)},$$slots:{default:!0}}),g(Q),g(V);var be=A(V,2);{var ge=n=>{var f=ze(),y=w(f);Ee(y,{onclick:fe,get GIFButtonTextSuccess(){return t.GIFButtonTextSuccess},get GIFButtonTextFailure(){return t.GIFButtonTextFailure},get volume(){return t.volume},get success(){return i(B)},set success(x){p(B,k(x))},get gifSoundPaused(){return i(a)},set gifSoundPaused(x){p(a,k(x))}}),g(f),T(n,f)};re(be,n=>{i(c)&&n(ge)})}g(j);var X=A(j,2),Ie=w(X);Ce(Ie,{}),g(X),T(r,K),ie()}export{it as P};
