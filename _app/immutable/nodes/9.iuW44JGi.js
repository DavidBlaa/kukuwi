import"../chunks/disclose-version.Bg9kRutz.js";import{p as V,t as z,r as p,a as W,A as e,D as r,as as J,s as S,F as a,c as v,f as le,C as pe}from"../chunks/runtime.B7fCM4Oa.js";import{d as X}from"../chunks/utils.D9OdP2rZ.js";import{a as w,t as x,c as fe}from"../chunks/template.hec62Xai.js";import{i as K}from"../chunks/if.DwGaze87.js";import{e as Y,i as Z,s as L}from"../chunks/class.B7YY2zb_.js";import{p as ve,a as m}from"../chunks/props.Cxt6yCBM.js";import{s as be,b as ge}from"../chunks/store.a1xX2E71.js";import{o as we}from"../chunks/index-client.D5hdirgC.js";import{p as ye}from"../chunks/index.DlITOSni.js";import{b as I}from"../chunks/paths.HHASukNr.js";import{p as he}from"../chunks/stores.Ld_CYEiv.js";import{H as xe,g as ke}from"../chunks/entry.Cc91kbW3.js";import{M as He,a as Ce,b as Re,G as Ee}from"../chunks/GIF.DvfJDxet.js";var Ne=x("<div></div>"),Te=x("<button></button>");function je(b,o){V(o,!0);let C=ve(o,"active",11,!1);const c=m([]);for(const[s,u]of o.pattern_array.entries())u?s%16<=3||8<=s%16&&s%16<=11?c.push("bg-green-600"):c.push("bg-green-700"):s%16<=3||8<=s%16&&s%16<=11?c.push("bg-gray-300"):c.push("bg-gray-400");var _=Te();_.__mouseup=function(...s){var u;(u=o.onmouseup)==null||u.apply(this,s)},Y(_,21,()=>c,Z,(s,u)=>{var y=Ne();z(()=>L(y,`h-full ${e(u)??""} border-black border`)),w(s,y)}),p(_),z(()=>L(_,` grid grid-cols-16 h-full w-full flex-row border-4 ${(C()?"border-blue-600 shadow-blue-600 shadow-2xl ":"border-gray-500")??""} rounded`)),w(b,_),W()}X(["mouseup"]);function Q(b,o){throw new xe(b,o)}new TextEncoder;const Ae=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"3_AmenBreaks.mid",audio_src:"3_Amen Breaks.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Custom1.mid",audio_src:"3_Custom 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rock1.mid",audio_src:"3_Rock 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rumba.mid",audio_src:"3_Rumba.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SiberianNights.mid",audio_src:"3_Siberian Nights.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SonClave.mid",audio_src:"3_Son Clave.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_FunkyDrummer.mid",audio_src:"4_Funky Drummer.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_House1.mid",audio_src:"4_House 1.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_House2.mid",audio_src:"4_House 2.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_Rock2.mid",audio_src:"4_Rock 2.wav",instrument_type:"drum",n_instruments:4}];var Be=x('<div class="h-full w-full basis-1/6"><!></div>'),Fe=(b,o)=>o(),Me=x('<div class="absolute top-0 left-0"><!></div>'),Se=x(`<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5 bg-s h-11/12 border-12"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <button class="
            flex
            flex-col
            mt-3
						h-fit
						w-10/12
            justify-center
            bg-amber-500
            rounded-lg
            cursor-pointer
            select-none
            active:translate-y-2  active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
            active:border-b-[0px]
            transition-all duration-150 [box-shadow:0_8px_0_0_#cf860a,0_13px_0_0_#1b70f841]
            border-[1px]
            p-3
            text-3xl
        ">Raten</button></div></div> <!></div>`);function We(b,o){V(o,!0);const C=be(),c=()=>ge(he,"$page",C),_=m([]);let s=a(0),u=a(-1),y=a(!1),P=a("4_Rock 2.wav"),R=a(!1),E=a(!1),N=a(!1),k=a(!1),D=a(0),T=a(!0),G=a(0),ee=0,$=a(.4);const te=async(t,n)=>{const i=await(await fetch(I+"/midis/"+t)).arrayBuffer(),d=new Uint8Array(i);console.log(d);const U=ye(d),h=24,g={},H=[];let q=0;for(const f of U.tracks[0])q+=f.deltaTime,f.type=="noteOn"&&(f.noteNumber in g||(g[f.noteNumber]=[]),g[f.noteNumber].push(q));for(const[,f]of Object.entries(g))for(let M=0;M<16;M++)H.push(f.includes(M*h));_.push({pattern:H,selected:!1,index:n})};we(()=>{const t=c().url.searchParams.get("instrument");(t==null||!["drum"].includes(t))&&Q(404,{message:"Instrument not found"});let n=c().url.searchParams.get("rows");(t==null||!["2","3","4"].includes(n))&&Q(404,{message:"rows amount incorrect"});const l=Ce(Ae.filter(i=>i.instrument_type==t&&i.n_instruments==Number(n)),3);r(s,m(Re(l))),r(P,m(l[e(s)].audio_src));for(const[i,d]of l.entries())te(d.midi_src,i);r(y,!0),ie()});function re(t){e(u)!=t&&(r(u,m(t)),_.forEach(n=>{n.selected=n.index==t}))}function se(){r(k,e(s)==e(u)),r(T,!1),r(E,!0),r(R,!0),r(N,!1)}function ne(){e(k)?ke(I+"/"):(J(G),r(T,!0),r(R,!1))}function ie(){setInterval(()=>{e(T)&&J(D)},1e3)}var j=Se(),A=v(j),B=v(A),ae=v(B);{var oe=t=>{var n=fe(),l=le(n);Y(l,17,()=>_,Z,(i,d,U)=>{var h=Be(),g=v(h);je(g,{get pattern_array(){return e(d).pattern},onmouseup:()=>re(e(d).index),get active(){return e(d).selected},set active(H){e(d).selected=H}}),p(h),w(i,h)}),w(t,n)};K(ae,t=>{e(y)&&t(oe)})}p(B);var O=S(B,2),F=v(O),ue=v(F),_e=pe(()=>I+"/audios/pattern_sounds/"+e(P));He(ue,{get repeats(){return ee},get time(){return e(D)},get track_source(){return e(_e)},get tries(){return e(G)},get track_paused(){return e(E)},set track_paused(t){r(E,m(t))}}),p(F);var de=S(F,2);de.__mousedown=[Fe,se],p(O),p(A);var me=S(A,2);{var ce=t=>{var n=Me(),l=v(n);Ee(l,{onclick:ne,get success(){return e(k)},set success(i){r(k,m(i))},get gif_sound_pause(){return e(N)},set gif_sound_pause(i){r(N,m(i))},get volume(){return e($)},set volume(i){r($,m(i))}}),p(n),w(t,n)};K(me,t=>{e(R)&&t(ce)})}p(j),w(b,j),W()}X(["mousedown"]);export{We as component};
