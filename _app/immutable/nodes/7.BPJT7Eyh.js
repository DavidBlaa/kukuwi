import"../chunks/disclose-version.Bg9kRutz.js";import{p as V,t as z,r as f,a as W,q as e,x as r,J as D,s as G,y as o,c as v,f as ce,w as _e}from"../chunks/runtime.D-iqYtEX.js";import{d as X}from"../chunks/utils.C1iE3jgQ.js";import{a as h,t as y,c as me}from"../chunks/template.BupBTwqF.js";import{p as fe,a as c,i as K}from"../chunks/props.ClIkjSu0.js";import{e as Y,a as Z,s as L}from"../chunks/instruments.DtAMHCsK.js";import{s as pe,b as ve}from"../chunks/store.Hc9_tdwe.js";import{o as be}from"../chunks/index-client.GnuGpeS1.js";import{p as ge}from"../chunks/index.DlITOSni.js";import{b as A}from"../chunks/paths.m_-rGt98.js";import{p as he}from"../chunks/stores.DaMmu2sK.js";import{H as we,g as xe}from"../chunks/entry.C3uSy8KT.js";import{M as ye,a as ke,b as He,G as Ce}from"../chunks/GIF.BHofcQHC.js";var Ee=y("<div></div>"),Te=y("<button></button>");function je(b,i){V(i,!0);let H=fe(i,"active",11,!1);const _=c([]);for(const[s,u]of i.pattern_array.entries())u?s%16<=3||8<=s%16&&s%16<=11?_.push("bg-green-600"):_.push("bg-green-700"):s%16<=3||8<=s%16&&s%16<=11?_.push("bg-gray-300"):_.push("bg-gray-400");var d=Te();d.__mouseup=function(...s){var u;(u=i.onmouseup)==null||u.apply(this,s)},Y(d,21,()=>_,Z,(s,u)=>{var w=Ee();z(()=>L(w,`h-full ${e(u)??""} border-black border`)),h(s,w)}),f(d),z(()=>L(d,` grid grid-cols-16 h-full w-full flex-row border-4 ${(H()?"border-blue-600 shadow-blue-600 shadow-2xl ":"border-gray-500")??""} rounded`)),h(b,d),W()}X(["mouseup"]);function Q(b,i){throw new we(b,i)}new TextEncoder;const Me=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"drum",n_instruments:2}];var Ie=y('<div class="h-full w-full basis-1/6"><!></div>'),Ne=(b,i)=>i(),Pe=y('<div class="absolute top-0 left-0"><!></div>'),Re=y(`<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5 bg-s h-11/12 border-12"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <button class="
            flex
            flex-col
            mt-3
						h-fit
						w-10/12
            justify-center
            bg-amber-500
            rounded-lg
            cursor-pointer
            select-none
            active:translate-y-2  active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
            active:border-b-[0px]
            transition-all duration-150 [box-shadow:0_8px_0_0_#cf860a,0_13px_0_0_#1b70f841]
            border-[1px]
            p-3
            text-3xl
        ">Raten</button></div></div> <!></div>`);function Le(b,i){V(i,!0);const H=pe(),_=()=>ve(he,"$page",H),d=c([]);let s=o(0),u=o(-1),w=o(!1),F=o("4_Rock 2.wav"),C=o(!1),E=o(!1),T=o(!1),k=o(!1),O=o(0),j=o(!0),q=o(0),ee=0,J=o(.4);const te=async(t,n)=>{const a=await(await fetch(A+"/midis/"+t)).arrayBuffer(),l=new Uint8Array(a);console.log(l);const x=ge(l),R=24,g={},U=[];let $=0;for(const p of x.tracks[0])$+=p.deltaTime,p.type=="noteOn"&&(p.noteNumber in g||(g[p.noteNumber]=[]),g[p.noteNumber].push($));for(const[,p]of Object.entries(g))for(let B=0;B<16;(B+=1)-1)U.push(p.includes(B*R));d.push({pattern:U,selected:!1,index:n})};be(()=>{const t=_().url.searchParams.get("instrument");(t==null||!["drum"].includes(t))&&Q(404,{message:"Instrument not found"});let n=_().url.searchParams.get("rows");(t==null||!["2","3","4"].includes(n))&&Q(404,{message:"rows amount incorrect"});const m=ke(Me.filter(a=>a.instrument_type==t&&a.n_instruments==Number(n)),3);r(s,c(He(m))),r(F,c(m[e(s)].audio_src));for(const[a,l]of m.entries())te(l.midi_src,a);r(w,!0),ae()});function re(t){e(u)!=t&&(r(u,c(t)),d.forEach(n=>{n.selected=n.index==t}))}function se(){r(k,e(s)==e(u)),r(j,!1),r(E,!0),r(C,!0),r(T,!1)}function ne(){e(k)?xe(A+"/"):(D(q),r(j,!0),r(C,!1))}function ae(){setInterval(()=>{e(j)&&D(O)},1e3)}var M=Re(),I=v(M),N=v(I),oe=v(N);K(oe,()=>e(w),t=>{var n=me(),m=ce(n);Y(m,17,()=>d,Z,(a,l)=>{var x=Ie(),R=v(x);je(R,{get pattern_array(){return e(l).pattern},get active(){return e(l).selected},set active(g){e(l).selected=g},onmouseup:()=>re(e(l).index)}),f(x),h(a,x)}),h(t,n)}),f(N);var S=G(N,2),P=v(S),ie=v(P),ue=_e(()=>A+"/audios/pattern_sounds/"+e(F));ye(ie,{get track_paused(){return e(E)},set track_paused(t){r(E,c(t))},get repeats(){return ee},get time(){return e(O)},get track_source(){return e(ue)},get tries(){return e(q)}}),f(P);var de=G(P,2);de.__mousedown=[Ne,se],f(S),f(I);var le=G(I,2);K(le,()=>e(C),t=>{var n=Pe(),m=v(n);Ce(m,{get success(){return e(k)},set success(a){r(k,c(a))},onclick:ne,get gif_sound_pause(){return e(T)},set gif_sound_pause(a){r(T,c(a))},get volume(){return e(J)},set volume(a){r(J,c(a))}}),f(n),h(t,n)}),f(M),h(b,M),W()}X(["mousedown"]);export{Le as component};
