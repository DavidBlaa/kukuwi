import"../chunks/disclose-version.Bg9kRutz.js";import{p as W,t as L,r as b,a as X,y as i,a3 as m,au as z,s as A,a4 as v,c as I,f as pe,A as le}from"../chunks/runtime.DBSzk1xQ.js";import{d as Y}from"../chunks/events.FZMNKl5r.js";import{a as S,t as H,c as ve}from"../chunks/template.Cv5zbk9r.js";import{i as J}from"../chunks/if.C_dJyYU9.js";import{e as Z,i as ee}from"../chunks/each.DiXPEE9N.js";import{p as ye,a as x}from"../chunks/props.CLTgNlsy.js";import{s as xe,b as he}from"../chunks/store.Dy6pcxBO.js";import{o as be}from"../chunks/index-client.Dr7F_-OI.js";import{b as D}from"../chunks/paths.6sx1FV_N.js";import{s as K}from"../chunks/class.DooIvUr-.js";import{p as ge}from"../chunks/stores.BiqWo3cW.js";import{H as we,g as Ie}from"../chunks/entry.DbkYKqAf.js";import{M as Ue,a as ke,b as Se,G as Ee}from"../chunks/GIF.B8kDpmAR.js";function Te(r){var t=new f(r),d=t.readChunk();if(d.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+d.id+"'";for(var c=Be(d.data),a=[],s=0;!t.eof()&&s<c.numTracks;s++){var e=t.readChunk();if(e.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+e.id+"'";var u=Ce(e.data);a.push(u)}return{header:c,tracks:a}}function Be(r){var t=new f(r),d=t.readUInt16(),c=t.readUInt16(),a={format:d,numTracks:c},s=t.readUInt16();return s&32768?(a.framesPerSecond=256-(s>>8),a.ticksPerFrame=s&255):a.ticksPerBeat=s,a}function Ce(r){for(var t=new f(r),d=[];!t.eof();){var c=s();d.push(c)}return d;var a;function s(){var e={};e.deltaTime=t.readVarInt();var u=t.readUInt8();if((u&240)===240)if(u===255){e.meta=!0;var E=t.readUInt8(),n=t.readVarInt();switch(E){case 0:if(e.type="sequenceNumber",n!==2)throw"Expected length for sequenceNumber event is 2, got "+n;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(n),e;case 2:return e.type="copyrightNotice",e.text=t.readString(n),e;case 3:return e.type="trackName",e.text=t.readString(n),e;case 4:return e.type="instrumentName",e.text=t.readString(n),e;case 5:return e.type="lyrics",e.text=t.readString(n),e;case 6:return e.type="marker",e.text=t.readString(n),e;case 7:return e.type="cuePoint",e.text=t.readString(n),e;case 32:if(e.type="channelPrefix",n!=1)throw"Expected length for channelPrefix event is 1, got "+n;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",n!=1)throw"Expected length for portPrefix event is 1, got "+n;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",n!=0)throw"Expected length for endOfTrack event is 0, got "+n;return e;case 81:if(e.type="setTempo",n!=3)throw"Expected length for setTempo event is 3, got "+n;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",n!=5)throw"Expected length for smpteOffset event is 5, got "+n;var U=t.readUInt8(),T={0:24,32:25,64:29,96:30};return e.frameRate=T[U&96],e.hour=U&31,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",n!=2&&n!=4)throw"Expected length for timeSignature event is 4 or 2, got "+n;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),n===4?(e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",n!=2)throw"Expected length for keySignature event is 2, got "+n;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(n),e;default:return e.type="unknownMeta",e.data=t.readBytes(n),e.metatypeByte=E,e}}else if(u==240){e.type="sysEx";var n=t.readVarInt();return e.data=t.readBytes(n),e}else if(u==247){e.type="endSysEx";var n=t.readVarInt();return e.data=t.readBytes(n),e}else throw"Unrecognised MIDI event type byte: "+u;else{var _;if(u&128)_=t.readUInt8(),a=u;else{if(a===null)throw"Running status byte encountered before status byte";_=u,u=a,e.running=!0}var B=u>>4;switch(e.channel=u&15,B){case 8:return e.type="noteOff",e.noteNumber=_,e.velocity=t.readUInt8(),e;case 9:var g=t.readUInt8();return e.type=g===0?"noteOff":"noteOn",e.noteNumber=_,e.velocity=g,g===0&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=_,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=_,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=_,e;case 13:return e.type="channelAftertouch",e.amount=_,e;case 14:return e.type="pitchBend",e.value=_+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+B}}}}function f(r){this.buffer=r,this.bufferLen=this.buffer.length,this.pos=0}f.prototype.eof=function(){return this.pos>=this.bufferLen};f.prototype.readUInt8=function(){var r=this.buffer[this.pos];return this.pos+=1,r};f.prototype.readInt8=function(){var r=this.readUInt8();return r&128?r-256:r};f.prototype.readUInt16=function(){var r=this.readUInt8(),t=this.readUInt8();return(r<<8)+t};f.prototype.readInt16=function(){var r=this.readUInt16();return r&32768?r-65536:r};f.prototype.readUInt24=function(){var r=this.readUInt8(),t=this.readUInt8(),d=this.readUInt8();return(r<<16)+(t<<8)+d};f.prototype.readInt24=function(){var r=this.readUInt24();return r&8388608?r-16777216:r};f.prototype.readUInt32=function(){var r=this.readUInt8(),t=this.readUInt8(),d=this.readUInt8(),c=this.readUInt8();return(r<<24)+(t<<16)+(d<<8)+c};f.prototype.readBytes=function(r){var t=this.buffer.slice(this.pos,this.pos+r);return this.pos+=r,t};f.prototype.readString=function(r){var t=this.readBytes(r);return String.fromCharCode.apply(null,t)};f.prototype.readVarInt=function(){for(var r=0;!this.eof();){var t=this.readUInt8();if(t&128)r+=t&127,r<<=7;else return r+t}return r};f.prototype.readChunk=function(){var r=this.readString(4),t=this.readUInt32(),d=this.readBytes(t);return{id:r,length:t,data:d}};var He=Te,Me=He,Ne=H("<div></div>"),Pe=H("<button></button>");function Re(r,t){W(t,!0);let d=ye(t,"active",11,!1);const c=x([]);for(const[s,e]of t.pattern_array.entries())e?s%16<=3||8<=s%16&&s%16<=11?c.push("bg-green-600"):c.push("bg-green-700"):s%16<=3||8<=s%16&&s%16<=11?c.push("bg-gray-300"):c.push("bg-gray-400");var a=Pe();a.__mouseup=function(...s){var e;(e=t.onmouseup)==null||e.apply(this,s)},Z(a,21,()=>c,ee,(s,e)=>{var u=Ne();L(()=>K(u,`h-full ${i(e)??""} border-black border`)),S(s,u)}),b(a),L(()=>K(a,` grid grid-cols-16 h-full w-full flex-row border-4 ${(d()?"border-blue-600 shadow-blue-600 shadow-2xl ":"border-gray-500")??""} rounded`)),S(r,a),X()}Y(["mouseup"]);function Q(r,t){throw new we(r,t)}new TextEncoder;const Oe=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"3_AmenBreaks.mid",audio_src:"3_Amen Breaks.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Custom1.mid",audio_src:"3_Custom 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rock1.mid",audio_src:"3_Rock 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rumba.mid",audio_src:"3_Rumba.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SiberianNights.mid",audio_src:"3_Siberian Nights.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SonClave.mid",audio_src:"3_Son Clave.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_FunkyDrummer.mid",audio_src:"4_Funky Drummer.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_House1.mid",audio_src:"4_House 1.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_House2.mid",audio_src:"4_House 2.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_Rock2.mid",audio_src:"4_Rock 2.wav",instrument_type:"drum",n_instruments:4}];var Fe=H('<div class="h-full w-full basis-1/6"><!></div>'),Ae=(r,t)=>t(),De=H('<div class="absolute top-0 left-0"><!></div>'),je=H(`<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5 bg-s h-11/12 border-12"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <button class="
            flex
            flex-col
            mt-3
						h-fit
						w-10/12
            justify-center
            bg-amber-500
            rounded-lg
            cursor-pointer
            select-none
            active:translate-y-2  active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
            active:border-b-[0px]
            transition-all duration-150 [box-shadow:0_8px_0_0_#cf860a,0_13px_0_0_#1b70f841]
            border-[1px]
            p-3
            text-3xl
        ">Raten</button></div></div> <!></div>`);function tt(r,t){W(t,!0);const d=xe(),c=()=>he(ge,"$page",d),a=x([]);let s=v(0),e=v(-1),u=v(!1),E=v("4_Rock 2.wav"),n=v(!1),U=v(!1),T=v(!1),_=v(!1),B=v(0),g=v(!0),j=v(0),te=0,V=v(.4);const re=async(o,p)=>{const l=await(await fetch(D+"/midis/"+o)).arrayBuffer(),y=new Uint8Array(l);console.log(y);const q=Me(y),C=24,k={},M=[];let G=0;for(const w of q.tracks[0])G+=w.deltaTime,w.type=="noteOn"&&(w.noteNumber in k||(k[w.noteNumber]=[]),k[w.noteNumber].push(G));for(const[,w]of Object.entries(k))for(let F=0;F<16;F++)M.push(w.includes(F*C));a.push({pattern:M,selected:!1,index:p})};be(()=>{const o=c().url.searchParams.get("instrument");(o==null||!["drum"].includes(o))&&Q(404,{message:"Instrument not found"});let p=c().url.searchParams.get("rows");(o==null||!["2","3","4"].includes(p))&&Q(404,{message:"rows amount incorrect"});const h=ke(Oe.filter(l=>l.instrument_type==o&&l.n_instruments==Number(p)),3);m(s,x(Se(h))),m(E,x(h[i(s)].audio_src));for(const[l,y]of h.entries())re(y.midi_src,l);m(u,!0),ie()});function ne(o){i(e)!=o&&(m(e,x(o)),a.forEach(p=>{p.selected=p.index==o}))}function se(){m(_,i(s)==i(e)),m(g,!1),m(U,!0),m(n,!0),m(T,!1)}function ae(){i(_)?Ie(D+"/"):(z(j),m(g,!0),m(n,!1))}function ie(){setInterval(()=>{i(g)&&z(B)},1e3)}var N=je(),P=I(N),R=I(P),oe=I(R);{var ue=o=>{var p=ve(),h=pe(p);Z(h,17,()=>a,ee,(l,y,q)=>{var C=Fe(),k=I(C);Re(k,{get pattern_array(){return i(y).pattern},onmouseup:()=>ne(i(y).index),get active(){return i(y).selected},set active(M){i(y).selected=M}}),b(C),S(l,C)}),S(o,p)};J(oe,o=>{i(u)&&o(ue)})}b(R);var $=A(R,2),O=I($),de=I(O),ce=le(()=>D+"/audios/pattern_sounds/"+i(E));Ue(de,{get repeats(){return te},get time(){return i(B)},get track_source(){return i(ce)},get tries(){return i(j)},get track_paused(){return i(U)},set track_paused(o){m(U,x(o))}}),b(O);var me=A(O,2);me.__mousedown=[Ae,se],b($),b(P);var fe=A(P,2);{var _e=o=>{var p=De(),h=I(p);Ee(h,{onclick:ae,get success(){return i(_)},set success(l){m(_,x(l))},get gif_sound_pause(){return i(T)},set gif_sound_pause(l){m(T,x(l))},get volume(){return i(V)},set volume(l){m(V,x(l))}}),b(p),S(o,p)};J(fe,o=>{i(n)&&o(_e)})}b(N),S(r,N),X()}Y(["mousedown"]);export{tt as component};
