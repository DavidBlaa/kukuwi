import"../chunks/disclose-version.Bg9kRutz.js";import{p as V,t as $,r as p,a as W,q as e,x as r,J as z,s as F,y as a,c as v,f as me,w as ce}from"../chunks/runtime.D-iqYtEX.js";import{d as X}from"../chunks/utils.C1iE3jgQ.js";import{a as w,t as x,c as le}from"../chunks/template.BupBTwqF.js";import{p as pe,a as m,i as K}from"../chunks/props.ClIkjSu0.js";import{e as Y,a as Z,s as L}from"../chunks/instruments.DtAMHCsK.js";import{s as fe,b as ve}from"../chunks/store.Hc9_tdwe.js";import{o as be}from"../chunks/index-client.GnuGpeS1.js";import{p as ge}from"../chunks/index.DlITOSni.js";import{b as I}from"../chunks/paths.CBLNQTrC.js";import{p as we}from"../chunks/stores.DDkBtELc.js";import{H as ye,g as he}from"../chunks/entry.B2lYy0-B.js";import{M as xe,a as ke,b as He,G as Ce}from"../chunks/GIF.C9h-991w.js";var Re=x("<div></div>"),Ee=x("<button></button>");function Ne(b,o){V(o,!0);let H=pe(o,"active",11,!1);const c=m([]);for(const[s,u]of o.pattern_array.entries())u?s%16<=3||8<=s%16&&s%16<=11?c.push("bg-green-600"):c.push("bg-green-700"):s%16<=3||8<=s%16&&s%16<=11?c.push("bg-gray-300"):c.push("bg-gray-400");var _=Ee();_.__mouseup=function(...s){var u;(u=o.onmouseup)==null||u.apply(this,s)},Y(_,21,()=>c,Z,(s,u)=>{var y=Re();$(()=>L(y,`h-full ${e(u)??""} border-black border`)),w(s,y)}),p(_),$(()=>L(_,` grid grid-cols-16 h-full w-full flex-row border-4 ${(H()?"border-blue-600 shadow-blue-600 shadow-2xl ":"border-gray-500")??""} rounded`)),w(b,_),W()}X(["mouseup"]);function Q(b,o){throw new ye(b,o)}new TextEncoder;const Te=[{midi_src:"2_Custom2.mid",audio_src:"2_Custom2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Custom3.mid",audio_src:"2_Custom3.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro1.mid",audio_src:"2_Elektro 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Elektro2.mid",audio_src:"2_Elektro 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop1.mid",audio_src:"2_Hip Hop 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_HipHop2.mid",audio_src:"2_Hip Hop 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_1.mid",audio_src:"2_Techno 1.wav",instrument_type:"drum",n_instruments:2},{midi_src:"2_Techno_2.mid",audio_src:"2_Techno 2.wav",instrument_type:"drum",n_instruments:2},{midi_src:"3_AmenBreaks.mid",audio_src:"3_Amen Breaks.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Custom1.mid",audio_src:"3_Custom 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rock1.mid",audio_src:"3_Rock 1.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_Rumba.mid",audio_src:"3_Rumba.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SiberianNights.mid",audio_src:"3_Siberian Nights.wav",instrument_type:"drum",n_instruments:3},{midi_src:"3_SonClave.mid",audio_src:"3_Son Clave.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_FunkyDrummer.mid",audio_src:"4_Funky Drummer.wav",instrument_type:"drum",n_instruments:3},{midi_src:"4_House1.mid",audio_src:"4_House 1.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_House2.mid",audio_src:"4_House 2.wav",instrument_type:"drum",n_instruments:4},{midi_src:"4_Rock2.mid",audio_src:"4_Rock 2.wav",instrument_type:"drum",n_instruments:4}];var je=x('<div class="h-full w-full basis-1/6"><!></div>'),Be=(b,o)=>o(),Me=x('<div class="absolute top-0 left-0"><!></div>'),Se=x(`<div class="flex h-full w-full flex-col items-center justify-center bg-blue-300"><div class="ml-2 flex w-11/12 flex-row justify-evenly rounded-2xl border-8 bg-gray-600 p-5 bg-s h-11/12 border-12"><div class="flex basis-9/12 flex-col items-center justify-evenly"><!></div> <div class="flex basis-1/6 flex-col items-center"><div class="h-5/6"><!></div> <button class="
            flex
            flex-col
            mt-3
						h-fit
						w-10/12
            justify-center
            bg-amber-500
            rounded-lg
            cursor-pointer
            select-none
            active:translate-y-2  active:[box-shadow:0_0px_0_0_#1b6ff8,0_0px_0_0_#1b70f841]
            active:border-b-[0px]
            transition-all duration-150 [box-shadow:0_8px_0_0_#cf860a,0_13px_0_0_#1b70f841]
            border-[1px]
            p-3
            text-3xl
        ">Raten</button></div></div> <!></div>`);function Le(b,o){V(o,!0);const H=fe(),c=()=>ve(we,"$page",H),_=m([]);let s=a(0),u=a(-1),y=a(!1),P=a("4_Rock 2.wav"),C=a(!1),R=a(!1),E=a(!1),k=a(!1),G=a(0),N=a(!0),D=a(0),ee=0,O=a(.4);const te=async(t,n)=>{const i=await(await fetch(I+"/midis/"+t)).arrayBuffer(),d=new Uint8Array(i);console.log(d);const h=ge(d),S=24,g={},J=[];let U=0;for(const f of h.tracks[0])U+=f.deltaTime,f.type=="noteOn"&&(f.noteNumber in g||(g[f.noteNumber]=[]),g[f.noteNumber].push(U));for(const[,f]of Object.entries(g))for(let A=0;A<16;(A+=1)-1)J.push(f.includes(A*S));_.push({pattern:J,selected:!1,index:n})};be(()=>{const t=c().url.searchParams.get("instrument");(t==null||!["drum"].includes(t))&&Q(404,{message:"Instrument not found"});let n=c().url.searchParams.get("rows");(t==null||!["2","3","4"].includes(n))&&Q(404,{message:"rows amount incorrect"});const l=ke(Te.filter(i=>i.instrument_type==t&&i.n_instruments==Number(n)),3);r(s,m(He(l))),r(P,m(l[e(s)].audio_src));for(const[i,d]of l.entries())te(d.midi_src,i);r(y,!0),ie()});function re(t){e(u)!=t&&(r(u,m(t)),_.forEach(n=>{n.selected=n.index==t}))}function se(){r(k,e(s)==e(u)),r(N,!1),r(R,!0),r(C,!0),r(E,!1)}function ne(){e(k)?he(I+"/"):(z(D),r(N,!0),r(C,!1))}function ie(){setInterval(()=>{e(N)&&z(G)},1e3)}var T=Se(),j=v(T),B=v(j),ae=v(B);K(ae,()=>e(y),t=>{var n=le(),l=me(n);Y(l,17,()=>_,Z,(i,d)=>{var h=je(),S=v(h);Ne(S,{get pattern_array(){return e(d).pattern},get active(){return e(d).selected},set active(g){e(d).selected=g},onmouseup:()=>re(e(d).index)}),p(h),w(i,h)}),w(t,n)}),p(B);var q=F(B,2),M=v(q),oe=v(M),ue=ce(()=>I+"/audios/pattern_sounds/"+e(P));xe(oe,{get track_paused(){return e(R)},set track_paused(t){r(R,m(t))},get repeats(){return ee},get time(){return e(G)},get track_source(){return e(ue)},get tries(){return e(D)}}),p(M);var _e=F(M,2);_e.__mousedown=[Be,se],p(q),p(j);var de=F(j,2);K(de,()=>e(C),t=>{var n=Me(),l=v(n);Ce(l,{get success(){return e(k)},set success(i){r(k,m(i))},onclick:ne,get gif_sound_pause(){return e(E)},set gif_sound_pause(i){r(E,m(i))},get volume(){return e(O)},set volume(i){r(O,m(i))}}),p(n),w(t,n)}),p(T),w(b,T),W()}X(["mousedown"]);export{Le as component};
